version: '2'
services:
  postgres:
    image: postgres:9.6.1
    container_name: templatestack_postgres
    volumes:
      - ./.data/postgres:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=templatestack
      - POSTGRES_PASSWORD=templatestack
      - POSTGRES_DB=templatestack
  redis:
    image: redis
    container_name: templatestack_redis
    volumes:
      - ./.data/redis:/data
  nats:
    image: nats
    container_name: templatestack_nats
  frontend:
    build:
      context: ./
      dockerfile: Dockerfile.frontend
    ports:
      - "80:80"
    container_name: templatestack_frontend
    entrypoint:
      - "bash"
      - "run.sh"
    volumes:
      - ./frontend:/app/frontend
      - /app/frontend/node_modules/
      - ./shared:/app/frontend/node_modules/shared
    environment:
      - MANUALRUN
      - LINKMODULES
  api:
    build:
      context: ./
      dockerfile: Dockerfile.api
    container_name: templatestack_api
    entrypoint:
      - "bash"
      - "run.sh"
    volumes:
      - ./api:/app/api
      - /app/api/node_modules/
      - ./shared:/app/frontend/node_modules/shared
    environment:
      - MANUALRUN
      - POSTGRES_SERVICE_USER=templatestack
      - POSTGRES_SERVICE_PASSWORD=templatestack
      - POSTGRES_SERVICE_DATABASE=templatestack
      - COOKIE_SECRET=apples
    